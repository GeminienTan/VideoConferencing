<html>
<head>
<title>Meego Administrative Dashboard</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://npmcdn.com/js-alert/dist/jsalert.min.js"></script>


<style>
body, html {
  height: 100%;
}
body,h1,h2,h3,h4,h5 {
    font-family: "Palatino Linotype", serif
}

table,th,td {
	text-align: center;
	font-size: 13px;
	border-collapse: collapse;
}

.topnav {
	overflow: hidden;
	background:linear-gradient(145deg,rgba(140,167,255,1) 0,rgba(139,84,249,1) 50%,rgba(131,33,243,1) 100%);
}

.topnav a {
	float: left;
	display: block;
	color: #333;
	text-align: center;
	padding: 14px 16px;
	text-decoration: none;
	font-size: 17px;
}

.topnav .icon {
	display: none;
}

.dropdown {
	float: left;
	overflow: hidden;
}

.dropdown .dropbtn {
	font-size: 17px;
	border: none;
	outline: none;
	color: #333;
	padding: 14px 16px;
	background-color: inherit;
	font-family: inherit;
	margin: 0;
}

.dropdown-content {
	display: none;
	position: absolute;
	background-color: #f9f9f9;
	min-width: 160px;
	box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
	z-index: 1;
}

.dropdown-content a {
	float: none;
	color: black;
	padding: 12px 16px;
	text-decoration: none;
	display: block;
	text-align: left;
}

.topnav a:hover,
.dropdown:hover .dropbtn {
	background-color: #9865FD;
	color: white;
}

.dropdown-content a:hover {
	background-color: #ffe6ea;
	color: black;
}

.dropdown:hover .dropdown-content {
	display: block;
}

@media screen and (max-width: 600px) {

	.topnav a:not(:first-child),
	.dropdown .dropbtn {
		display: none;
	}

	.topnav a.icon {
		float: right;
		display: block;
	}
}

@media screen and (max-width: 600px) {
	.topnav.responsive {
		position: relative;
	}

	.topnav.responsive .icon {
		position: absolute;
		right: 0;
		top: 0;
	}

	.topnav.responsive a {
		float: none;
		display: block;
		text-align: left;
	}

	.topnav.responsive .dropdown {
		float: none;
	}

	.topnav.responsive .dropdown-content {
		position: relative;
	}

	.topnav.responsive .dropdown .dropbtn {
		display: block;
		width: 100%;
		text-align: left;
	}
}
</style>
</head>
<body>
	<!-- Navigation Bar -->
	<div class="topnav" id="myTopnav">
		<a href="/admin/dashboard" class="logo w3-left"><img height=80 src="../dist/img/meego-logo.png"></a>
		<a href="getAllUser">User List</a>
		<a href="getAllGuest">Guest List</a>
		<a href="getAllAdmin">Admin List</a>
		<a href="getAllFeedback">Feedback</a>
		<a onclick="logout()" class="w3-right">Logout</a>
	</div>
	<br>
  <!-- Page Header -->
	<h2 align="center">Meego Administrative Dashboard</h2>

	<!-- Page Content -->
	<div class="w3-main">
    <!-- Graph and Table Yellowstone EXT I -->
		<div class="w3-panel">
			<div class="w3-row-padding" style="margin:0 -16px">
				<div class="w3-half" style="height: 300px">
					<h5>Distribution of Meego Users by Gender</h5>
					<canvas id="ys_1"></canvas>
				</div>
				<div class="w3-half" style="margin-top:60px">
					<h5 class="w3-center">Gender</h5>
					<table id="table_ys1" data-id="table_ys1" class="w3-table w3-white w3-hoverable w3-bordered">
						<tr class="showDetails">
							<td><span class="w3-btn" style="background-color:#FF6384"></span></td>
							<td>Female</td>
							<td>0</td>
						</tr>
						<tr class="showDetails">
							<td><span class="w3-btn" style="background-color:#36A2EB"></span></td>
							<td>Male</td>
							<td>0</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
		<hr>
    <!-- Graph and Table Yellowstone EXT II -->
		<div class="w3-panel">
			<div class="w3-row-padding" style="margin:0 -16px">
				<div class="w3-half" style="height: 300px">
					<h5>Distribution of Meego Users by Age Group</h5>
					<canvas id="ys_2"></canvas>
				</div>
				<div class="w3-half" style="margin-top:60px">
					<h5 class="w3-center">Age Group </h5>
					<table id="table_ys2" data-id="table_ys2" class="w3-table w3-white w3-hoverable w3-bordered">
						<tr class="showDetails">
							<td><span class="w3-btn" style="background-color:#FF6384"></span></td>
							<td>Children (0-14 years old)</td>
							<td>0</td>
						</tr>
						<tr class="showDetails">
							<td><span class="w3-btn" style="background-color:#FF9F40"></span></td>
							<td>Early Working Age (15-24 years old)</td>
							<td>0</td>
						</tr>
						<tr class="showDetails">
							<td><span class="w3-btn" style="background-color:#4BC0C0"></span></td>
							<td>Prime Working Age (25-54 years old)</td>
							<td>0</td>
						</tr>
						<tr class="showDetails">
							<td><span class="w3-btn" style="background-color:#36A2EB"></span></td>
							<td>Mature Working Age (55-64 years old)</td>
							<td>0</td>
						</tr>
						<tr class="showDetails">
							<td><span class="w3-btn" style="background-color:#9966FF"></span></td>
							<td>Elderly (65 years and over)</td>
							<td>0</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
		<hr>
	<!-- End page content -->
	</div>
  
	<script>
	var tday = new Date()
	var today = tday.getFullYear() + "-" + ('0' + (tday.getMonth() + 1)).slice(-2) + "-" + ('0' + tday.getDate()).slice(-2);
	$(document).ready(function() {
		$.ajax({
			url: "/admin/getUserDataByGender",
			method: "GET",
			success: function(data) {
				var data = JSON.parse(data);
				var Gender = [];
				var Count = [];

				for(var i in data) {
					if(data[i].gender == 'F') {
						Gender.push('Female');
						Count.push(data[i].count);
					}else if(data[i].gender == 'M') {
						Gender.push('Male');
						Count.push(data[i].count);
					}
				}
				var chartdata = {
					labels: Gender,
					datasets: [{
						barThickness: 6,
						label: '',
						backgroundColor: ['#FF6384', '#36A2EB'],
						hoverBackgroundColor: ['#FFE0E6', '#36A2EB'],
						hoverBorderColor: '#666666',
						data: Count
					}]
				};
				var bar_canvas = $("#ys_1");
				var barGraph = new Chart(bar_canvas, {
					type: 'bar',
					data: chartdata,
					options: {
						maintainAspectRatio: false,
						title: {
							display: true,
							text: 'Total Number of user ' + today
						},
						legend: {
							display: false
						},
						scales: {
							xAxes: [{
								ticks: {
									autoSkip: false,
									maxRotation: 0,
									minRotation: 0
								}
							}],
							yAxes: [{
								ticks: {
									min: 0,
									precision:0
								}
							}]
						}
					}
				});
				for(i in Count) {
					document.getElementById("table_ys1").rows[i].cells.item(1).innerHTML = Gender[i]
					document.getElementById("table_ys1").rows[i].cells.item(2).innerHTML = Count[i]
				}
			},
			error: function(data) {
				console.log(data);
			}
		});

		$.ajax({
			url: "/admin/getUserDataByAgeGroup",
			method: "GET",
			success: function(data) {
				var data = JSON.parse(data);
				var  defaultAgeGroup = ["0-14","15-24","25-54","55-64","65 years and over"];

				var AgeGroup = [];
				var Count = [];

				for(var i in data) {
						AgeGroup.push(data[i].age_group);
						Count.push(data[i].count);
				}

				let difference = defaultAgeGroup.filter(x => !AgeGroup.includes(x));
				if(difference.length!=0){
					AgeGroup.push(difference);
					Count.push(0);
				}

				var chartdata = {
					labels: AgeGroup,
					datasets: [{
						barThickness: 6,
						label: '',
						backgroundColor: ['#FF6384', '#FF9F40', '#4BC0C0', '#36A2EB', '#9966FF'],
						hoverBackgroundColor: ['#FFE0E6', '#FFECD9', '#DBF2F2', '#D7ECFB', '#EBE0FF'],
						hoverBorderColor: '#666666',
						data: Count
					}]
				};
				var bar_canvas = $("#ys_2");
				var barGraph = new Chart(bar_canvas, {
					type: 'bar',
					data: chartdata,
					options: {
						maintainAspectRatio: false,
						title: {
							display: true,
							text: 'Total Number of user ' + today
						},
						legend: {
							display: false
						},
						scales: {
							xAxes: [{
								ticks: {
									autoSkip: false,
									maxRotation: 0,
									minRotation: 0
								}
							}],
							yAxes: [{
								ticks: {
									min: 0,
									precision:0
								}
							}]
						}
					}
				});
				for(i in AgeGroup) {
					document.getElementById("table_ys2").rows[i].cells.item(1).innerHTML = AgeGroup[i]
					document.getElementById("table_ys2").rows[i].cells.item(2).innerHTML = Count[i]
				}
			},
			error: function(data) {
				console.log(data);
			}
		});
	});
		
	var canvas = document.querySelector('canvas');
	fitToContainer(canvas);

	function fitToContainer(canvas) {
		// Make it visually fill the positioned parent
		canvas.style.width = '100%';
		canvas.style.height = '100%';
		// ...then set the internal size to match
		canvas.width = canvas.offsetWidth;
		canvas.height = canvas.offsetHeight;
	}
	
	</script>
	<script src="../dist/js/admin.js"></script>
	<script src="../dist/js/validatePassword.js"></script>
</body>

</html>